import cv2
import image # Custom library
import image_proc # Another custom library

'''
A class that processes targets.
'''
class TargetProc:
	# Calculates the distance, angle, and height to width ratio of the specified contour.
	def procTarget(self, constants, contours, updater):
		largestCnt, secondLargestCnt = contours

		_x, _y, wpx, hpx = cv2.boundingRect(largestCnt)
						
		# Find the centroid's coordinates
		cntcoords = image.getContourCentroidCoords(largestCnt)
		cnt2coords = image.getContourCentroidCoords(secondLargestCnt)
		if cntcoords == None or cnt2coords == None:
			pass
		else:
			cx, cy = cntcoords
			cx2, cy2 = cnt2coords
			pegx = (cx + cx2) / 2 # Find the x-coord of the peg (the average of the x-coordinates of the two vision targets)
			# Print out information
			distance = image_proc.getDistance(constants.imghpx, 5.08, hpx, constants.getValue("viewangle"))
			angle = image_proc.getHorizAngle(constants.imgwpx, 5.08, distance, hpx, pegx)
			ratio = float(hpx)/float(wpx)
			pegclose = ratio < 2
			if constants.getValue("printdata"):
				updater.printData(ratio, angle, distance, pegclose)
			if constants.getValue("senddata"):
				updater.sendData(constants.sd, angle, distance, pegclose, True)
		return pegclose
	
	# Returns a polygonal approximation of the specified target.
	def approxTarget(self, contour):
		x, y, w, h = cv2.boundingRect(contour)
		print("Width: " + str(w))
		return cv2.approxPolyDP(contour, w/3, True)
